{"remainingRequest":"/home/wuzhanfly/git/filscan-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/wuzhanfly/git/filscan-frontend/src/views/home/components/table/MessageTable.vue?vue&type=style&index=0&id=3e60fb6a&lang=scss&scoped=true&","dependencies":[{"path":"/home/wuzhanfly/git/filscan-frontend/src/views/home/components/table/MessageTable.vue","mtime":1613722984206},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5tZXNzYWdlLXRhYmxlIHsKICBkaXYgewogICAgYmFja2dyb3VuZDogdmFyKC0tbWFpbi1iZy1jb2xvcik7CiAgfQp9Cg=="},{"version":3,"sources":["MessageTable.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoJA;AACA;AACA;AACA;AACA","file":"MessageTable.vue","sourceRoot":"src/views/home/components/table","sourcesContent":["<template>\n  <div class=\"message-table\">\n    <base-table\n      :dataSource=\"messageTable.dataSource\"\n      :columns=\"messageTable.columns\"\n      :loadMore=\"true\"\n      @load=\"loadMessageData\"\n      :showLoading=\"messageTable.loading\"\n      :showAppend=\"messageTable.append && !isMobile\"\n      :max-height=\"isMobile ? 200 : 400 * rate\"\n      @click-append=\"goTo('messageList')\"\n      :labels=\"$t('home.messageTable.label')\"\n      radius\n    ></base-table>\n  </div>\n</template>\n<script>\nimport { getLatestMessage } from \"@/api/home\";\nimport { mapState } from \"vuex\";\nexport default {\n  name: \"MessageTable\",\n  data() {\n    return {\n      messageTable: {\n        dataSource: [],\n        columns: [\n          {\n            key: \"id\",\n            target: \"message/detail\",\n            paramKey: \"cid\",\n            isLink: true,\n            ellipsis: true\n          },\n          {\n            key: \"time\"\n          },\n          {\n            key: \"from\",\n            isLink: true,\n            target: \"address/detail\",\n            paramKey: \"address\",\n            ellipsis: true\n          },\n          {\n            key: \"to\",\n            isLink: true,\n            target: \"address/detail\",\n            paramKey: \"address\",\n            ellipsis: true\n          },\n          {\n            key: \"value\"\n          }\n        ],\n        loadCount: 0,\n        loading: false,\n        append: false,\n        timer: null\n      }\n    };\n  },\n  methods: {\n    initMesTimer() {\n      this.messageTable.timer = setInterval(() => {\n        this.messageTable.dataSource = this.messageTable.dataSource.map(\n          item => {\n            return {\n              ...item,\n              time: this.formatTime(item.originTime, item.current),\n              current: item.current + 1000\n            };\n          }\n        );\n      }, 1000);\n    },\n    async getMessageData(num) {\n      if (num > 30) {\n        return;\n      }\n      this.messageTable.loading = true;\n      try {\n        const data = await getLatestMessage(num);\n\n        const dataSource = data.msg.map(item => {\n          const { from, to, value } = item.msg;\n          const current = new Date().getTime();\n          const realTime =\n            item.msgcreate > current / 1000 ? current / 1000 : item.msgcreate;\n            console.log(\"value:\",)\n          return {\n            from,\n            to,\n            value: value,\n            time: this.formatTime(realTime),\n            originTime: realTime,\n            current: current,\n            id: item.cid\n          };\n        });\n        this.messageTable.dataSource = dataSource;\n        this.messageTable.loading = false;\n        return Promise.resolve();\n      } catch (e) {\n        this.messageTable.loading = false;\n      }\n    },\n    async loadMessageData() {\n      if (this.messageTable.loading) {\n        return;\n      }\n      if (this.messageTable.loadCount == 3) {\n        this.messageTable.append = true;\n        return;\n      } else {\n        clearInterval(this.messageTable.timer);\n        try {\n          this.messageTable.loading = true;\n          await this.getMessageData(10 * (this.messageTable.loadCount + 1));\n          this.messageTable.loadCount++;\n          this.messageTable.loading = false;\n          this.initMesTimer();\n        } catch (e) {\n          if (e) {\n            this.messageTable.loading = false;\n          }\n        }\n      }\n    }\n  },\n  watch: {\n    async latestBlockHeight() {\n      if (this.loadCount === 1) {\n        return;\n      }\n      clearInterval(this.messageTable.timer);\n      await this.getMessageData(this.messageTable.loadCount * 10);\n      this.initMesTimer();\n    }\n  },\n  computed: {\n    ...mapState([\"rate\"])\n  },\n  beforeDestroy() {\n    clearInterval(this.messageTable.timer);\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n.message-table {\n  div {\n    background: var(--main-bg-color);\n  }\n}\n</style>\n"]}]}