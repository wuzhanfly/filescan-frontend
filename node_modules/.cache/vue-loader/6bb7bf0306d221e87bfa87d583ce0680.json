{"remainingRequest":"/home/wuzhanfly/git/filscan-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/wuzhanfly/git/filscan-frontend/src/views/home/components/table/BlockTable.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/wuzhanfly/git/filscan-frontend/src/views/home/components/table/BlockTable.vue","mtime":1612684657988},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/wuzhanfly/git/filscan-frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldExhdGVzdEJsb2NrIH0gZnJvbSAiQC9hcGkvaG9tZSI7CmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAidnVleCI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQmxvY2tUYWJsZSIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGJsb2NrVGFibGU6IHsKICAgICAgICBkYXRhU291cmNlOiBbXSwKICAgICAgICBzcGFuOiB0cnVlLAogICAgICAgIGNvbHVtbnM6IFsKICAgICAgICAgIHsKICAgICAgICAgICAga2V5OiAiaGVpZ2h0IiwKICAgICAgICAgICAgaXNMaW5rOiB0cnVlLAogICAgICAgICAgICB0YXJnZXQ6ICJ0aXBzZXQiCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBrZXk6ICJoYXNoIiwKICAgICAgICAgICAgaXNMaW5rOiB0cnVlLAogICAgICAgICAgICB0YXJnZXQ6ICJ0aXBzZXQiLAogICAgICAgICAgICBlbGxpcHNpczogdHJ1ZQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAga2V5OiAidGltZSIKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGtleTogIm1pbmVyIiwKICAgICAgICAgICAgaXNMaW5rOiB0cnVlLAogICAgICAgICAgICB0YXJnZXQ6ICJhZGRyZXNzL2RldGFpbCIsCiAgICAgICAgICAgIHBhcmFtS2V5OiAiYWRkcmVzcyIKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGtleTogInJld2FyZCIsCiAgICAgICAgICAgIHVuaXQ6ICJGSUwiCiAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICBsb2FkQ291bnQ6IDAsCiAgICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgICAgYXBwZW5kOiBmYWxzZSwKICAgICAgICBoZWlnaHRNYXA6IHt9LAogICAgICAgIHRpbWVyOiBudWxsCiAgICAgIH0KICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICBpbml0QmxvY2tUaW1lcigpIHsKICAgICAgdGhpcy5ibG9ja1RhYmxlLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgIHRoaXMuYmxvY2tUYWJsZS5oZWlnaHRNYXAgPSB7fTsKICAgICAgICBjb25zdCBoZWlnaHRNYXAgPSB7fTsKICAgICAgICB0aGlzLmJsb2NrVGFibGUuZGF0YVNvdXJjZSA9IHRoaXMuYmxvY2tUYWJsZS5kYXRhU291cmNlLm1hcCgKICAgICAgICAgIChpdGVtLCBpbmRleCkgPT4gewogICAgICAgICAgICBpZiAoaGVpZ2h0TWFwW2l0ZW0uaGVpZ2h0XSkgewogICAgICAgICAgICAgIGhlaWdodE1hcFtpdGVtLmhlaWdodF0uc3BhbisrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGhlaWdodE1hcFtpdGVtLmhlaWdodF0gPSB7CiAgICAgICAgICAgICAgICBzcGFuOiAxLAogICAgICAgICAgICAgICAgaW5kZXg6IGluZGV4CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSAvL+ihqOWktOWQiOW5tgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIC4uLml0ZW0sCiAgICAgICAgICAgICAgdGltZTogdGhpcy5mb3JtYXRUaW1lKGl0ZW0ub3JpZ2luVGltZSwgaXRlbS5jdXJyZW50KSwKICAgICAgICAgICAgICBjdXJyZW50OiBpdGVtLmN1cnJlbnQgKyAxMDAwCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgKTsKICAgICAgICBPYmplY3QudmFsdWVzKGhlaWdodE1hcCkuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgIHRoaXMuYmxvY2tUYWJsZS5oZWlnaHRNYXBbaXRlbS5pbmRleF0gPSBpdGVtLnNwYW47CiAgICAgICAgfSk7CiAgICAgIH0sIDEwMDApOwogICAgfSwKICAgIGFzeW5jIGdldEJsb2NrRGF0YShudW0pIHsKICAgICAgaWYgKG51bSA+IDMwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuYmxvY2tUYWJsZS5oZWlnaHRNYXAgPSB7fTsKICAgICAgdGhpcy5ibG9ja1RhYmxlLmxvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLmJsb2NrVGFibGUuc3BhbiA9IGZhbHNlOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBnZXRMYXRlc3RCbG9jayhudW0pOwogICAgICAgIGNvbnN0IGhlaWdodE1hcCA9IHt9OwogICAgICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBkYXRhLmJsb2NrX2hlYWRlci5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7CiAgICAgICAgICBjb25zdCB7IGhlaWdodCwgbWluZXIsIHRpbWVzdGFtcCB9ID0gaXRlbS5ibG9ja19oZWFkZXI7CiAgICAgICAgICBpZiAoaGVpZ2h0TWFwW2hlaWdodF0pIHsKICAgICAgICAgICAgaGVpZ2h0TWFwW2hlaWdodF0uc3BhbisrOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaGVpZ2h0TWFwW2hlaWdodF0gPSB7CiAgICAgICAgICAgICAgc3BhbjogMSwKICAgICAgICAgICAgICBpbmRleAogICAgICAgICAgICB9OwogICAgICAgICAgfSAvL+ihqOWktOWQiOW5tgogICAgICAgICAgY29uc3QgY3VycmVudCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgY29uc3QgcmVhbFRpbWUgPQogICAgICAgICAgICB0aW1lc3RhbXAgPiBjdXJyZW50IC8gMTAwMCA/IGN1cnJlbnQgLyAxMDAwIDogdGltZXN0YW1wOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmZvcm1hdE51bWJlcihoZWlnaHQpLAogICAgICAgICAgICBoYXNoOiBpdGVtLmNpZCwKICAgICAgICAgICAgdGltZTogdGhpcy5mb3JtYXRUaW1lKHJlYWxUaW1lKSwKICAgICAgICAgICAgb3JpZ2luVGltZTogcmVhbFRpbWUsCiAgICAgICAgICAgIG1pbmVyOiBtaW5lciwKICAgICAgICAgICAgcmV3YXJkOiBOdW1iZXIoaXRlbS5yZXdhcmQpLnRvRml4ZWQoNSksCiAgICAgICAgICAgIGN1cnJlbnQ6IGN1cnJlbnQKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ibG9ja1RhYmxlLmRhdGFTb3VyY2UgPSBkYXRhU291cmNlOwogICAgICAgIE9iamVjdC52YWx1ZXMoaGVpZ2h0TWFwKS5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgdGhpcy5ibG9ja1RhYmxlLmhlaWdodE1hcFtpdGVtLmluZGV4XSA9IGl0ZW0uc3BhbjsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmJsb2NrVGFibGUubG9hZGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuYmxvY2tUYWJsZS5zcGFuID0gdHJ1ZTsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB0aGlzLmJsb2NrVGFibGUubG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgbG9hZEJsb2NrRGF0YSgpIHsKICAgICAgaWYgKHRoaXMuYmxvY2tUYWJsZS5sb2FkaW5nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmJsb2NrVGFibGUubG9hZENvdW50ID09IDMpIHsKICAgICAgICB0aGlzLmJsb2NrVGFibGUuYXBwZW5kID0gdHJ1ZTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmJsb2NrVGFibGUudGltZXIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLmJsb2NrVGFibGUubG9hZGluZyA9IHRydWU7CiAgICAgICAgICBhd2FpdCB0aGlzLmdldEJsb2NrRGF0YSgxMCAqICh0aGlzLmJsb2NrVGFibGUubG9hZENvdW50ICsgMSkpOwogICAgICAgICAgdGhpcy5ibG9ja1RhYmxlLmxvYWRDb3VudCsrOwogICAgICAgICAgdGhpcy5ibG9ja1RhYmxlLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuaW5pdEJsb2NrVGltZXIoKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICB0aGlzLmJsb2NrVGFibGUubG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIGFzeW5jIGxhdGVzdEJsb2NrSGVpZ2h0KCkgewogICAgICBpZiAodGhpcy5sb2FkQ291bnQgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmJsb2NrVGFibGUudGltZXIpOwogICAgICBhd2FpdCB0aGlzLmdldEJsb2NrRGF0YSh0aGlzLmJsb2NrVGFibGUubG9hZENvdW50ICogMTApOwogICAgICB0aGlzLmluaXRCbG9ja1RpbWVyKCk7CiAgICB9CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgY2xlYXJJbnRlcnZhbCh0aGlzLmJsb2NrVGFibGUudGltZXIpOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKFsicmF0ZSJdKQogIH0KfTsK"},{"version":3,"sources":["BlockTable.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BlockTable.vue","sourceRoot":"src/views/home/components/table","sourcesContent":["<template>\n  <div class=\"block-table\">\n    <base-table\n      :dataSource=\"blockTable.dataSource\"\n      :columns=\"blockTable.columns\"\n      :loadMore=\"true\"\n      @load=\"loadBlockData\"\n      :showLoading=\"blockTable.loading\"\n      :showAppend=\"blockTable.append && !isMobile\"\n      @click-append=\"goTo('tipset')\"\n      :span-map=\"blockTable.heightMap\"\n      :span=\"blockTable.span\"\n      :max-height=\"isMobile ? 200 : 400 * rate\"\n      :labels=\"$t('home.blockTable.label')\"\n      radius\n      :stripe=\"false\"\n    ></base-table>\n  </div>\n</template>\n<script>\nimport { getLatestBlock } from \"@/api/home\";\nimport { mapState } from \"vuex\";\nexport default {\n  name: \"BlockTable\",\n  data() {\n    return {\n      blockTable: {\n        dataSource: [],\n        span: true,\n        columns: [\n          {\n            key: \"height\",\n            isLink: true,\n            target: \"tipset\"\n          },\n          {\n            key: \"hash\",\n            isLink: true,\n            target: \"tipset\",\n            ellipsis: true\n          },\n          {\n            key: \"time\"\n          },\n          {\n            key: \"miner\",\n            isLink: true,\n            target: \"address/detail\",\n            paramKey: \"address\"\n          },\n          {\n            key: \"reward\",\n            unit: \"FIL\"\n          }\n        ],\n        loadCount: 0,\n        loading: false,\n        append: false,\n        heightMap: {},\n        timer: null\n      }\n    };\n  },\n  methods: {\n    initBlockTimer() {\n      this.blockTable.timer = setInterval(() => {\n        this.blockTable.heightMap = {};\n        const heightMap = {};\n        this.blockTable.dataSource = this.blockTable.dataSource.map(\n          (item, index) => {\n            if (heightMap[item.height]) {\n              heightMap[item.height].span++;\n            } else {\n              heightMap[item.height] = {\n                span: 1,\n                index: index\n              };\n            } //表头合并\n            return {\n              ...item,\n              time: this.formatTime(item.originTime, item.current),\n              current: item.current + 1000\n            };\n          }\n        );\n        Object.values(heightMap).forEach(item => {\n          this.blockTable.heightMap[item.index] = item.span;\n        });\n      }, 1000);\n    },\n    async getBlockData(num) {\n      if (num > 30) {\n        return;\n      }\n      this.blockTable.heightMap = {};\n      this.blockTable.loading = true;\n      this.blockTable.span = false;\n      try {\n        const data = await getLatestBlock(num);\n        const heightMap = {};\n        const dataSource = data.block_header.map((item, index) => {\n          const { height, miner, timestamp } = item.block_header;\n          if (heightMap[height]) {\n            heightMap[height].span++;\n          } else {\n            heightMap[height] = {\n              span: 1,\n              index\n            };\n          } //表头合并\n          const current = new Date().getTime();\n          const realTime =\n            timestamp > current / 1000 ? current / 1000 : timestamp;\n          return {\n            height: this.formatNumber(height),\n            hash: item.cid,\n            time: this.formatTime(realTime),\n            originTime: realTime,\n            miner: miner,\n            reward: Number(item.reward).toFixed(5),\n            current: current\n          };\n        });\n        this.blockTable.dataSource = dataSource;\n        Object.values(heightMap).forEach(item => {\n          this.blockTable.heightMap[item.index] = item.span;\n        });\n        this.blockTable.loading = false;\n        this.blockTable.span = true;\n        return Promise.resolve();\n      } catch (e) {\n        this.blockTable.loading = false;\n      }\n    },\n    async loadBlockData() {\n      if (this.blockTable.loading) {\n        return;\n      }\n      if (this.blockTable.loadCount == 3) {\n        this.blockTable.append = true;\n        return;\n      } else {\n        clearInterval(this.blockTable.timer);\n        try {\n          this.blockTable.loading = true;\n          await this.getBlockData(10 * (this.blockTable.loadCount + 1));\n          this.blockTable.loadCount++;\n          this.blockTable.loading = false;\n          this.initBlockTimer();\n        } catch (e) {\n          this.blockTable.loading = false;\n        }\n      }\n    }\n  },\n  watch: {\n    async latestBlockHeight() {\n      if (this.loadCount === 1) {\n        return;\n      }\n      clearInterval(this.blockTable.timer);\n      await this.getBlockData(this.blockTable.loadCount * 10);\n      this.initBlockTimer();\n    }\n  },\n  beforeDestroy() {\n    clearInterval(this.blockTable.timer);\n  },\n  computed: {\n    ...mapState([\"rate\"])\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n.block-miner-table {\n  display: flex;\n  & > div {\n    flex: 1;\n    max-width: 50%;\n    background: var(--main-bg-color);\n  }\n  & > div:first-child {\n    margin-right: 10px;\n  }\n  .table-title {\n    padding: 15px;\n    background: var(--main-bg-color);\n    border-bottom: 1px solid #ccc;\n    display: flex;\n    justify-content: space-between;\n    img {\n      width: 20px;\n      margin-right: 15px;\n    }\n  }\n}\n</style>\n"]}]}